<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Live Kafka News Stream</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; padding: 1rem; }
    #log { white-space: pre-wrap; border: 1px solid #ddd; padding: 1rem; height: 70vh; overflow: auto; background:#f9f9f9;}
    .item { margin-bottom: 0.75rem; padding: 0.5rem; border-radius: 4px; background: #fff; box-shadow: 0 1px 0 rgba(0,0,0,.03); }
    .meta { color: #666; font-size: 0.9rem; margin-bottom: 0.25rem; }
  </style>
</head>
<body>
  <h1>Live Kafka News Stream</h1>
  <p>Topic: <strong id="topic"></strong></p>
  <div id="log"></div>

  <script>
    const topic = new URLSearchParams(window.location.search).get('topic') || 'finance-news';
    document.getElementById('topic').textContent = topic;

    const es = new EventSource('/stream');

    es.onmessage = function(event) {
      const log = document.getElementById('log');

      let content = event.data;
      try {
        const obj = JSON.parse(content);
        content = JSON.stringify(obj, null, 2);
      } catch (e) {
      }

      const wrapper = document.createElement('div');
      wrapper.className = 'item';

      const meta = document.createElement('div');
      meta.className = 'meta';
      meta.textContent = new Date().toLocaleTimeString();

      const pre = document.createElement('pre');
      pre.textContent = content;

      wrapper.appendChild(meta);
      wrapper.appendChild(pre);
      log.insertBefore(wrapper, log.firstChild);

      while (log.childElementCount > 200) {
        log.removeChild(log.lastChild);
      }
    };

    es.onerror = function(e) {
      console.error('SSE error', e);
    };
  </script>
</body>
</html>
